name: Industrialisation continue sur le serveur Alwaysdata

on:
  push:
    paths:
      - '**'

jobs:
  Deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Cloner le dÃ©pÃ´t localement pour inspection
        uses: actions/checkout@v3

      - name: Debug - Liste les fichiers du repo
        run: ls -R

      - name: DÃ©ploiement via SSH
        uses: appleboy/ssh-action@master
        with:
          host: "ssh-${{ secrets.USERNAME }}.alwaysdata.net"
          username: ${{ secrets.USERNAME }}
          password: ${{ secrets.PASSWORD }}
          script: |
            echo "ğŸ” Connexion au serveur"
            cd $HOME
            echo "ğŸ“ Clonage du dÃ©pÃ´t sur le serveur"
            rm -rf repo_temp
            git clone https://github.com/${{ github.repository }}.git repo_temp
            echo "ğŸ“‚ Contenu clonÃ© :"
            ls -R repo_temp

            if [ -d "$HOME/www" ]; then
              echo "ğŸš€ DÃ©ploiement des fichiers dans www/"
              rsync -av --delete repo_temp/ www/
              echo "ğŸ§¹ Nettoyage temporaire"
              rm -rf repo_temp
            else
              echo "âŒ Le rÃ©pertoire www n'existe pas sur le serveur"
              exit 1
            fi
